<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farsi Fun ‚Äî Learn Persian Basics</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #0f172a; color: white; }
    h1 { text-align:center; padding:20px; }
    .toolbar { display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; }
    button {
      background: #38bdf8; border: none; color: #000; font-size: 16px;
      padding: 10px 16px; margin: 10px 0; border-radius: 8px; cursor: pointer;
    }
    button:hover { filter: brightness(0.95); }
    #celebration {
      position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85); color: white; padding: 14px 18px;
      border-radius: 12px; font-size: 20px; z-index: 9999; display: none;
    }
    .card {
      max-width: 720px; margin: 0 auto; padding: 16px 20px 40px;
      background: #0c1630; border: 1px solid #1f2a44; border-radius: 16px;
    }
    .row { display:grid; grid-template-columns: 1fr; gap: 10px; }
    .fa { font-size: 46px; text-align:center; direction: rtl; }
    .en { font-size: 18px; text-align:center; color: #9fb2d3; }
    .trans { font-size: 18px; text-align:center; color: #cfe3ff; }
    .feedback { text-align:center; min-height: 22px; margin-top: 8px; color: #b0ffce; }
    .hint { text-align:center; color:#9fb2d3; font-size:14px; margin-top: 8px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>
</head>
<body>
  <h1>Farsi Fun ‚Äî Learn Persian Basics</h1>

  <div class="card">
    <div class="row">
      <div class="fa" id="fa">ÿ≥€åÿ®</div>
      <div class="en" id="en">apple</div>
      <div class="trans" id="trans">sib</div>
    </div>

    <div class="toolbar">
      <button id="prevBtn">‚¨ÖÔ∏è Prev</button>
      <button id="listenBtn">üîä Listen (your voice)</button>
      <button id="listenPhonBtn">üîä Listen (phonetic)</button>
      <button id="nextBtn">Next ‚û°Ô∏è</button>
    </div>

    <div class="toolbar">
      <input id="typeInput" placeholder="Type the phonetic (e.g., sib)" style="padding:10px;border-radius:8px;border:1px solid #1f2a44; background:#0a1330; color:#fff; width: min(480px,90%);" />
      <button id="checkBtn">‚úÖ Check</button>
    </div>

    <div class="feedback" id="feedback"></div>
    <div class="hint">Put your audio files in <code>/audio/</code>. The app will look for <code>/audio/&lt;transliteration&gt;.mp3</code> (or the file set per word).</div>
  </div>

  <div id="celebration">let's goooooo üéâ</div>

<script>
// ---------------------- Word list ----------------------
// Add "audio" to any item if you want a custom filename (in /audio/).
// Otherwise the code will look for /audio/<slugified translit>.mp3
const words = [
  {fa: "ÿ≥€åÿ®", en: "apple", translit: "sib"},
  {fa: "⁄©ÿ™ÿßÿ®", en: "book", translit: "ket√¢b", audio: "ketab.mp3"},
  {fa: "ÿÆÿßŸÜŸá", en: "house", translit: "kh√¢ne", audio: "khane.mp3"},
  {fa: "ŸÖÿßÿ¥€åŸÜ", en: "car", translit: "m√¢shin", audio: "mashin.mp3"},
  {fa: "ŸÖÿØÿ±ÿ≥Ÿá", en: "school", translit: "madrese"},
  {fa: "ÿØŸàÿ≥ÿ™", en: "friend", translit: "dust"},
  {fa: "ÿ¢ÿ®", en: "water", translit: "√¢b", audio: "ab.mp3"},
  {fa: "ŸÜÿßŸÜ", en: "bread", translit: "n√¢n", audio: "nan.mp3"},
  {fa: "⁄Üÿß€å", en: "tea", translit: "ch√¢y", audio: "chay.mp3"},
  {fa: "ŸÇŸáŸàŸá", en: "coffee", translit: "qahve", audio: "ghahve.mp3"},
  {fa: "ÿÆŸàÿ±ÿ¥€åÿØ", en: "sun", translit: "khorshid"},
  {fa: "ŸÖÿßŸá", en: "moon", translit: "m√¢h", audio: "mah.mp3"},
  {fa: "ÿ≥ÿ™ÿßÿ±Ÿá", en: "star", translit: "set√¢re", audio: "setare.mp3"},
  {fa: "ÿ¢ÿ≥ŸÖÿßŸÜ", en: "sky", translit: "√¢sem√¢n", audio: "aseman.mp3"},
  {fa: "ÿØÿ±€åÿß", en: "sea", translit: "dary√¢", audio: "darya.mp3"},
  {fa: "ÿ±ŸàÿØÿÆÿßŸÜŸá", en: "river", translit: "rudkh√¢ne", audio: "rudkhane.mp3"},
  {fa: "⁄©ŸàŸá", en: "mountain", translit: "kuh"},
  {fa: "ÿØÿ±ÿÆÿ™", en: "tree", translit: "derakht"},
  {fa: "⁄ØŸÑ", en: "flower", translit: "gol"},
  {fa: "ÿ®ÿ±⁄Ø", en: "leaf", translit: "barg"},
  {fa: "ÿ≤ŸÖ€åŸÜ", en: "earth", translit: "zamin"},
  {fa: "ÿ¢ÿ™ÿ¥", en: "fire", translit: "√¢tash", audio: "atash.mp3"},
  {fa: "ÿ®ÿßÿØ", en: "wind", translit: "b√¢d", audio: "bad.mp3"},
  {fa: "ÿ®ÿßÿ±ÿßŸÜ", en: "rain", translit: "b√¢r√¢n", audio: "baran.mp3"},
  {fa: "ÿ®ÿ±ŸÅ", en: "snow", translit: "barf"},
  {fa: "⁄Øÿ±⁄Ø", en: "wolf", translit: "gorg"},
  {fa: "ÿ≥⁄Ø", en: "dog", translit: "sag"},
  {fa: "⁄Øÿ±ÿ®Ÿá", en: "cat", translit: "gorbe"},
  {fa: "Ÿæÿ±ŸÜÿØŸá", en: "bird", translit: "parande"},
  {fa: "ŸÖÿßŸá€å", en: "fish", translit: "m√¢hi", audio: "mahi.mp3"},
  {fa: "ÿßÿ≥ÿ®", en: "horse", translit: "asb"},
  {fa: "ÿ¥€åÿ±", en: "lion/milk", translit: "shir"},
  {fa: "ŸÖŸàÿ≤", en: "banana", translit: "moz"},
  {fa: "Ÿæÿ±ÿ™ŸÇÿßŸÑ", en: "orange", translit: "portegh√¢l", audio: "porteghal.mp3"},
  {fa: "ÿßŸÜ⁄ØŸàÿ±", en: "grape", translit: "angur"},
  {fa: "ŸáŸÜÿØŸàÿßŸÜŸá", en: "watermelon", translit: "hendev√¢ne", audio: "hendevane.mp3"},
  {fa: "ŸÑ€åŸÖŸà", en: "lemon", translit: "limu"},
  {fa: "ÿ™Ÿàÿ™ ŸÅÿ±ŸÜ⁄Ø€å", en: "strawberry", translit: "tut farangi", audio: "tut-farangi.mp3"},
  {fa: "ÿßŸÜÿßÿ±", en: "pomegranate", translit: "an√¢r", audio: "anar.mp3"},
  {fa: "ÿÆ€åÿßÿ±", en: "cucumber", translit: "khi√¢r", audio: "khiar.mp3"},
  {fa: "⁄ØŸàÿ¨Ÿá", en: "tomato", translit: "goje"},
  {fa: "ÿ≥€åÿ® ÿ≤ŸÖ€åŸÜ€å", en: "potato", translit: "sib zamini", audio: "sib-zamini.mp3"},
  {fa: "ŸáŸà€åÿ¨", en: "carrot", translit: "havij"},
  {fa: "Ÿæ€åÿßÿ≤", en: "onion", translit: "piy√¢z", audio: "piyaz.mp3"},
  {fa: "ŸÅŸÑŸÅŸÑ", en: "pepper", translit: "felfel"},
  {fa: "⁄©ÿßŸáŸà", en: "lettuce", translit: "k√¢hu", audio: "kahu.mp3"},
  {fa: "ŸÇÿßÿ±⁄Ü", en: "mushroom", translit: "gh√¢rch", audio: "gharch.mp3"},
  {fa: "ÿ®ÿ±ŸÜÿ¨", en: "rice", translit: "berenj"},
  {fa: "⁄ØŸàÿ¥ÿ™", en: "meat", translit: "gusht"},
  {fa: "ŸÖÿ±ÿ∫", en: "chicken", translit: "morgh"},
  {fa: "ÿ™ÿÆŸÖ ŸÖÿ±ÿ∫", en: "egg", translit: "tokhm morgh", audio: "tokhm-morgh.mp3"},
  {fa: "ŸæŸÜ€åÿ±", en: "cheese", translit: "panir"},
  {fa: "⁄©ÿ±Ÿá", en: "butter", translit: "kare"}
];

// ---------------------- State & DOM ----------------------
let currentIndex = 0;
const faEl = document.getElementById('fa');
const enEl = document.getElementById('en');
const transEl = document.getElementById('trans');
const feedbackEl = document.getElementById('feedback');
const typeInput = document.getElementById('typeInput');

const listenBtn = document.getElementById('listenBtn');
const listenPhonBtn = document.getElementById('listenPhonBtn');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const checkBtn = document.getElementById('checkBtn');

// ---------------------- Helpers ----------------------
function slugifyTranslit(s){
  return (s||'')
    .toLowerCase()
    .normalize('NFKD')
    .replace(/[\u0302\u0304]/g,'') // strip diacritics like √¢/ƒÅ marks
    .replace(/[^a-z0-9\s-]/g,'')   // remove non-latin
    .trim()
    .replace(/\s+/g,'-');          // spaces -> dashes
}

function translitToSpeak(s){
  if(!s) return "";
  return s
    .replace(/√¢|ƒÅ/g,"aa")
    .replace(/kh/g,"kha")
    .replace(/gh/g,"gha")
    .replace(/sh/g,"sha")
    .replace(/ch/g,"cha")
    .replace(/j/g,"zhe"); // for Persian ⁄ò in this list
}

// Preload audio objects (optional but nice)
const audioCache = new Map();
function getAudioForWord(item){
  const filename = item.audio || (slugifyTranslit(item.translit) + ".mp3");
  const url = `audio/${filename}`;
  if(!audioCache.has(url)){
    const a = new Audio();
    a.preload = "auto";
    a.src = url;
    audioCache.set(url, a);
  }
  return audioCache.get(url);
}

// ---------------------- UI update ----------------------
function loadWord(i){
  const item = words[i];
  faEl.textContent = item.fa;
  enEl.textContent = item.en;
  transEl.textContent = item.translit;
  typeInput.value = '';
  feedbackEl.textContent = '';
}

// ---------------------- Celebration ----------------------
function playDing(){
  try {
    const C = window.AudioContext || window.webkitAudioContext; if(!C) return;
    const ctx = new C();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'triangle';
    o.frequency.value = 880;
    o.connect(g); g.connect(ctx.destination);
    const t = ctx.currentTime;
    g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(0.35,t+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.4);
    o.start(t); o.stop(t+0.42);
  } catch(e){}
}
function bottomBurst(){
  if(typeof confetti!=='function') return;
  const base={origin:{y:1,x:0.5},gravity:1.15,ticks:200,scalar:0.9};
  confetti({...base, particleCount:60, spread:70,  startVelocity:55});
  confetti({...base, particleCount:40, spread:100, startVelocity:45, origin:{y:1,x:0.2}});
  confetti({...base, particleCount:40, spread:100, startVelocity:45, origin:{y:1,x:0.8}});
}
function celebrate(){
  playDing();
  bottomBurst();
  const msg = document.getElementById('celebration');
  msg.style.display = 'block';
  setTimeout(()=> msg.style.display='none', 1500);
}

// ---------------------- TTS fallback (phonetic) ----------------------
let enVoice = null, voicesReady = false;
function pickEnglishVoice(){
  const voices = speechSynthesis.getVoices()||[];
  return (
    voices.find(v=>/^en(-|$)/i.test(v.lang) && /natural|neural|premium/i.test(v.name)) ||
    voices.find(v=>/^en(-|$)/i.test(v.lang)) ||
    voices[0] || null
  );
}
function ensureEnglishVoice(cb){
  if(voicesReady && enVoice){ cb(); return; }
  const tryPick = () => { enVoice = pickEnglishVoice(); voicesReady = true; cb(); };
  const existing = speechSynthesis.getVoices();
  if(existing && existing.length){ enVoice = pickEnglishVoice(); voicesReady = true; cb(); }
  else { speechSynthesis.onvoiceschanged = tryPick; }
}
function speakTransliteration(text){
  try{
    const phrase = translitToSpeak(text);
    ensureEnglishVoice(()=>{
      const u = new SpeechSynthesisUtterance(phrase);
      if(enVoice){ u.voice = enVoice; u.lang = enVoice.lang || "en-US"; }
      else { u.lang = "en-US"; }
      u.rate = 0.95;
      try{ speechSynthesis.cancel(); }catch{}
      speechSynthesis.speak(u);
    });
  }catch(e){ console.warn("TTS error", e); }
}

// ---------------------- Playback handlers ----------------------
async function playYourAudio(){
  const item = words[currentIndex];
  const a = getAudioForWord(item);
  try {
    a.currentTime = 0;
    await a.play();
  } catch(e){
    // Could be not found or blocked: fall back to phonetic TTS
    speakTransliteration(item.translit);
  }
}

listenBtn.addEventListener('click', playYourAudio);
listenPhonBtn.addEventListener('click', ()=>{
  speakTransliteration(words[currentIndex].translit);
});

// ---------------------- Navigation & checking ----------------------
function next(){ currentIndex = (currentIndex + 1) % words.length; loadWord(currentIndex); }
function prev(){ currentIndex = (currentIndex - 1 + words.length) % words.length; loadWord(currentIndex); }

nextBtn.addEventListener('click', next);
prevBtn.addEventListener('click', prev);

checkBtn.addEventListener('click', ()=>{
  const guess = (typeInput.value || '').trim().toLowerCase();
  const target = (words[currentIndex].translit || '').trim().toLowerCase();
  if(!guess){ feedbackEl.textContent = 'Type your guess first!'; return; }
  if(guess === target){
    feedbackEl.textContent = 'Great! ‚úÖ';
    celebrate();
    setTimeout(next, 600);
  } else {
    feedbackEl.textContent = `Not quite. Hint: ${words[currentIndex].translit}`;
  }
});

// Initial load
loadWord(currentIndex);
</script>
</body>
</html>
