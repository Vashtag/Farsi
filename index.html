<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farsi Fun ‚Äî Learn Persian Basics</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--accent:#22c55e;--accent-2:#38bdf8;--warn:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,Arial,"Apple Color Emoji","Segoe UI Emoji";margin:0;background:linear-gradient(135deg,#0b1028,#0f172a 25%,#0b1028 100%);color:var(--text)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px clamp(16px,4vw,32px);position:sticky;top:0;background:rgba(15,23,42,.75);backdrop-filter:blur(10px);border-bottom:1px solid #1f2937}
    header h1{font-size:clamp(18px,2.5vw,28px);margin:0;letter-spacing:.5px}
    .stats{display:flex;gap:12px}
    .badge{background:#111827;border:1px solid #1f2937;padding:6px 10px;border-radius:999px;font-size:14px;color:var(--muted)}
    main{max-width:960px;margin:24px auto;padding:0 clamp(16px,4vw,32px) 80px}
    .card{background:linear-gradient(180deg,#0b1229,#121a36);border:1px solid #1f2937;border-radius:16px;padding:clamp(16px,3vw,28px);box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:820px){.row{grid-template-columns:1fr 1fr}}
    .emoji{font-size:clamp(64px,12vw,120px);text-align:center;line-height:1;filter:drop-shadow(0 10px 20px rgba(0,0,0,.35))}
    .word{display:flex;flex-direction:column;gap:6px;align-items:flex-start;justify-content:center}
    .en{font-size:clamp(18px,2.2vw,22px);color:var(--muted)}
    .fa{font-size:clamp(36px,6vw,52px);font-weight:700;direction:rtl;text-align:right}
    .trans{font-size:clamp(16px,2vw,18px);color:#cbd5e1}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:10px}
    button,.btn{appearance:none;border:none;background:#111827;color:var(--text);border:1px solid #1f2937;padding:10px 14px;border-radius:12px;cursor:pointer;transition:transform .03s ease,background .2s ease,border-color .2s ease}
    button:hover{background:#0b1229;border-color:#263042}
    button:active{transform:translateY(1px)}
    .primary{background:linear-gradient(180deg,#22c55e,#16a34a);border-color:#14532d}
    .primary:hover{background:linear-gradient(180deg,#2fe272,#1fb157)}
    .accent{background:linear-gradient(180deg,#38bdf8,#0ea5e9);border-color:#075985}
    .input{background:#0b1229;border:1px solid #1f2937;padding:12px 14px;border-radius:12px;color:var(--text);width:100%;font-size:16px}
    .feedback{margin-top:8px;min-height:24px;font-size:15px}
    .ok{color:var(--accent)}
    .warn{color:var(--warn)}
    .err{color:var(--err)}
    .progress{margin-top:12px;height:10px;background:#0b1229;border-radius:999px;border:1px solid #1f2937;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#38bdf8,#22c55e);transition:width .4s ease}
    .mode{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .tiny{font-size:12px;color:var(--muted)}
    .tip{margin-top:12px;font-size:14px;color:#a5b4fc}
    footer{position:fixed;inset-block-end:12px;inset-inline:0;display:flex;justify-content:center;pointer-events:none}
    .footer-inner{pointer-events:auto;background:rgba(17,24,39,.9);border:1px solid #1f2937;border-radius:999px;padding:8px 14px;font-size:13px;color:var(--muted)}
    /* celebration styles */
    .cele-wrap{position:fixed;inset:0;pointer-events:none;display:grid;place-items:center;z-index:9999}
    .cele-msg{background:rgba(17,24,39,.9);border:1px solid #1f2937;padding:16px 22px;border-radius:14px;font-weight:700;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .cele-fetti{position:fixed;top:-10px;width:8px;height:14px;opacity:.9;transform:rotate(0deg);animation:fall 900ms linear forwards}
    @keyframes fall{to{transform:translateY(110vh) rotate(360deg);opacity:1}}
  </style>
</head>
<body>
  <header>
    <h1>‚ú® Farsi Fun ‚Äî Learn Persian Basics</h1>
    <div class="stats">
      <div class="badge" id="scoreBadge">Score: 0</div>
      <div class="badge" id="streakBadge">Streak: 0 üî•</div>
    </div>
  </header>

  <main>
    <div class="mode">
      <button id="learnBtn" class="btn">Learn Mode</button>
      <button id="quizBtn" class="btn">Quiz Mode</button>
      <span class="tiny">Tip: Click ‚ÄúListen‚Äù to hear Persian (fa-IR). ‚ÄúSay it‚Äù tests your pronunciation (Chrome works best).</span>
    </div>

    <div class="card">
      <div class="row">
        <div class="emoji" id="emoji">üçé</div>
        <div class="word">
          <div class="en" id="en">apple</div>
          <div class="fa" id="fa" dir="rtl">ÿ≥€åÿ®</div>
          <div class="trans" id="trans">sib</div>

          <div class="controls">
            <button id="listenBtn" class="accent">üîä Listen</button>
            <button id="sayBtn">üéôÔ∏è Say it</button>
            <button id="revealBtn">üëÄ Reveal</button>
            <button id="nextBtn" class="primary">‚û°Ô∏è Next</button>
          </div>

          <div class="feedback" id="speechFeedback"></div>

          <label class="tiny" for="typeInput">Type the pronunciation (English letters):</label>
          <input class="input" id="typeInput" placeholder="e.g., sib"/>
          <div class="controls">
            <button id="checkBtn">‚úÖ Check</button>
            <button id="skipBtn">‚è≠Ô∏è Skip</button>
          </div>
          <div class="feedback" id="typeFeedback"></div>

          <div class="progress"><div class="bar" id="progressBar"></div></div>
          <div class="tip" id="tip">Pronunciation tip: ‚Äúkh‚Äù is like German ‚ÄúBach‚Äù; ‚Äú√¢‚Äù like a in ‚Äúfather‚Äù.</div>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <div class="footer-inner">Edit or add words in the code ‚Äî look for the <b>words</b> array. Everything is offline & private.</div>
  </footer>

<script>
// ---------------------- Data ----------------------
const words = [
  { fa: "ÿ≥€åÿ®", en: "apple", translit: "sib", emoji: "üçé" },
  { fa: "⁄©ÿ™ÿßÿ®", en: "book", translit: "ket√¢b", emoji: "üìñ" },
  { fa: "⁄Øÿ±ÿ®Ÿá", en: "cat", translit: "gorbe", emoji: "üê±" },
  { fa: "ÿ≥⁄Ø", en: "dog", translit: "sag", emoji: "üê∂" },
  { fa: "ÿ¢ÿ®", en: "water", translit: "√¢b", emoji: "üíß" },
  { fa: "ŸÜÿßŸÜ", en: "bread", translit: "n√¢n", emoji: "üçû" },
  { fa: "⁄Üÿß€å", en: "tea", translit: "ch√¢y", emoji: "üçµ" },
  { fa: "ŸÖÿßÿ¥€åŸÜ", en: "car", translit: "m√¢shin", emoji: "üöó" },
  { fa: "ÿÆÿßŸÜŸá", en: "house", translit: "kh√¢ne", emoji: "üè†" },
  { fa: "ÿØÿ±", en: "door", translit: "dar", emoji: "üö™" },
  { fa: "ÿÆŸàÿ±ÿ¥€åÿØ", en: "sun", translit: "khorshid", emoji: "‚òÄÔ∏è" },
  { fa: "⁄ØŸÑ", en: "flower", translit: "gol", emoji: "üå∏" }
];

// ---------------------- State ----------------------
let idx = 0;
let mode = 'learn';
let score = Number(localStorage.getItem('ff_score')||0);
let streak = Number(localStorage.getItem('ff_streak')||0);
let completed = new Set(JSON.parse(localStorage.getItem('ff_done')||'[]'));

// ---------------------- DOM ----------------------
const el = (id) => document.getElementById(id);
const emojiEl = el('emoji');
const enEl = el('en');
const faEl = el('fa');
const transEl = el('trans');
const listenBtn = el('listenBtn');
const sayBtn = el('sayBtn');
const revealBtn = el('revealBtn');
const nextBtn = el('nextBtn');
const typeInput = el('typeInput');
const checkBtn = el('checkBtn');
const skipBtn = el('skipBtn');
const speechFeedback = el('speechFeedback');
const typeFeedback = el('typeFeedback');
const scoreBadge = el('scoreBadge');
const streakBadge = el('streakBadge');
const progressBar = el('progressBar');
const tip = el('tip');
const learnBtn = el('learnBtn');
const quizBtn = el('quizBtn');

function saveProgress(){
  localStorage.setItem('ff_score', String(score));
  localStorage.setItem('ff_streak', String(streak));
  localStorage.setItem('ff_done', JSON.stringify([...completed]));
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;
}
let order = shuffle([...words.keys()]);

function setMode(m){ mode=m; idx=0; order=shuffle([...words.keys()]); load(); }

function load(){
  const item = words[ order[idx] ];
  emojiEl.textContent = item.emoji;
  enEl.textContent = item.en;
  faEl.textContent = mode==='quiz' ? '‚Ä¢‚Ä¢‚Ä¢' : item.fa;
  transEl.textContent = mode==='quiz' ? '‚Äî' : item.translit;
  typeInput.value = '';
  speechFeedback.textContent = '';
  typeFeedback.textContent = '';
  scoreBadge.textContent = `Score: ${score}`;
  streakBadge.textContent = `Streak: ${streak} üî•`;
  const donePct = Math.round((completed.size / words.length) * 100);
  progressBar.style.width = donePct + '%';
}
function next(){ idx++; if(idx>=order.length){ idx=0; order=shuffle(order); } load(); }
function reveal(){ const item=words[ order[idx] ]; faEl.textContent=item.fa; transEl.textContent=item.translit; }

// ---------------------- Celebration (ding + confetti) ----------------------
function playDing(){
  try{
    const C = window.AudioContext || window.webkitAudioContext; if(!C) return;
    const ctx = new C();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type='sine'; o.frequency.value=880; // A5
    o.connect(g); g.connect(ctx.destination);
    const t = ctx.currentTime;
    g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(0.35,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.35);
    o.start(t); o.stop(t+0.36);
  }catch(e){}
}

function showCelebration(){
  // wrapper
  const wrap = document.createElement('div');
  wrap.className = 'cele-wrap';
  // message
  const msg = document.createElement('div');
  msg.className = 'cele-msg';
  msg.textContent = "let's goooooo";
  wrap.appendChild(msg);
  // confetti
  const colors = ['#fde047','#f472b6','#60a5fa','#34d399','#fca5a5','#c084fc'];
  const pieces = 60;
  for(let i=0;i<pieces;i++){
    const f = document.createElement('div');
    f.className = 'cele-fetti';
    f.style.left = Math.random()*100 + 'vw';
    f.style.background = colors[i%colors.length];
    f.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
    f.style.animationDuration = (700 + Math.random()*700) + 'ms';
    f.style.width = (6 + Math.random()*6) + 'px';
    f.style.height = (10 + Math.random()*10) + 'px';
    document.body.appendChild(f);
    setTimeout(()=>f.remove(), 1400);
  }
  document.body.appendChild(wrap);
  setTimeout(()=> wrap.remove(), 1200);
}

function celebrate(){ playDing(); showCelebration(); }

// ---------------------- TTS (Speak Persian) ----------------------
let faVoice=null, voicesLoaded=false;
function pickFaVoice(){ const voices=speechSynthesis.getVoices()||[]; const exact=voices.find(v=> (v.lang||'').toLowerCase().startsWith('fa')); if(exact) return exact; const fuzzy=voices.find(v=> /persian|farsi/i.test(((v.name||'')+' '+(v.lang||'')))); return fuzzy||null; }
function ensureVoicesReady(cb){ if(voicesLoaded && faVoice){cb();return;} const tryPick=()=>{ faVoice=pickFaVoice(); voicesLoaded=true; cb(); }; const existing=speechSynthesis.getVoices(); if(existing&&existing.length){ faVoice=pickFaVoice(); voicesLoaded=true; cb(); } else { speechSynthesis.onvoiceschanged=tryPick; } }
function speakFA(text){ try{ ensureVoicesReady(()=>{ const u=new SpeechSynthesisUtterance(text); if(faVoice){u.voice=faVoice; u.lang=faVoice.lang||'fa-IR';} else {u.lang='fa-IR';} u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u); }); }catch(e){} }
listenBtn.addEventListener('click', ()=>{ const item=words[ order[idx] ]; speakFA(item.fa); });

// ---------------------- Speech Recognition (Say it) ----------------------
function normalizeFa(s){ if(!s) return ''; return s.replace(/\s+/g,'').replace(/Ÿä/g,'€å').replace(/ŸÉ/g,'⁄©').replace(/[\u200C\u200F\u202A-\u202E]/g,''); }
const SR = window.SpeechRecognition || window.webkitSpeechRecognition; let rec=null; let micPrimed=false;
async function primeMic(){ if(micPrimed||!navigator.mediaDevices?.getUserMedia) return; try{ await navigator.mediaDevices.getUserMedia({audio:true}); micPrimed=true; }catch(e){ speechFeedback.textContent='Microphone permission is blocked. Please allow mic access (click the lock icon).'; speechFeedback.className='feedback err'; } }
if(SR){ rec=new SR(); rec.lang='fa-IR'; rec.interimResults=false; rec.maxAlternatives=3; rec.onresult=(ev)=>{ const item=words[ order[idx] ]; const heard=normalizeFa(ev.results[0][0].transcript); const target=normalizeFa(item.fa); const ok=heard.includes(target)||target.includes(heard); if(ok){ celebrate(); speechFeedback.textContent=`‚úîÔ∏è Heard: ${ev.results[0][0].transcript}`; speechFeedback.className='feedback ok'; score+=10; streak+=1; completed.add(order[idx]); saveProgress(); load(); } else { speechFeedback.textContent=`I heard ‚Äú${ev.results[0][0].transcript}‚Äù. Try again!`; speechFeedback.className='feedback warn'; streak=0; saveProgress(); } }; rec.onerror=(e)=>{ const kind=e?.error||'unknown'; const map={'no-speech':'No speech detected. Try speaking closer to the mic.','audio-capture':'No microphone found. Plug in or enable your mic.','not-allowed':'Mic access denied. Click the lock (üîí) in the address bar to allow the mic.','aborted':'Recognition aborted. Tap ‚ÄúSay it‚Äù again.'}; speechFeedback.textContent=map[kind]||('Mic error: '+kind); speechFeedback.className='feedback err'; }; } else { sayBtn.disabled=true; sayBtn.title='Speech recognition not supported in this browser. Use Chrome on desktop/mobile.'; }

sayBtn.addEventListener('click', async ()=>{ if(!rec){ speechFeedback.textContent='Speech recognition not supported on this device/browser.'; speechFeedback.className='feedback err'; return;} if(!window.isSecureContext){ speechFeedback.textContent='Mic only works over HTTPS. Open your published GitHub Pages link (https).'; speechFeedback.className='feedback err'; return;} await primeMic(); speechFeedback.textContent='Listening‚Ä¶ please say the Persian word'; speechFeedback.className='feedback'; try{ rec.start(); }catch{} });

// ---------------------- Typing Check ----------------------
function normalizeTranslit(s){ return (s||'').toLowerCase().normalize('NFKD').replace(/[\u0302\u0304]/g,'').replace(/\s+/g,''); }
checkBtn.addEventListener('click', ()=>{ const item=words[ order[idx] ]; const guess=normalizeTranslit(typeInput.value); const target=normalizeTranslit(item.translit); if(!guess){ typeFeedback.textContent='Type your guess first!'; typeFeedback.className='feedback warn'; return; } if(guess===target){ typeFeedback.textContent='Great! +10 points'; typeFeedback.className='feedback ok'; celebrate(); score+=10; streak+=1; completed.add(order[idx]); saveProgress(); next(); } else { typeFeedback.textContent=`Not quite. Hint: ${item.translit}`; typeFeedback.className='feedback warn'; streak=0; saveProgress(); } });

skipBtn.addEventListener('click', ()=>{ streak=0; saveProgress(); next(); });
nextBtn.addEventListener('click', next);
revealBtn.addEventListener('click', reveal);
learnBtn.addEventListener('click', ()=> setMode('learn'));
quizBtn.addEventListener('click', ()=> setMode('quiz'));

// Initial load
load();
</script>
</body>
</html>

